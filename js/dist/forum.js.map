{"version":3,"sources":["webpack://@flarum/markdown/webpack/bootstrap","webpack://@flarum/markdown/external \"flarum.core.compat['extend']\"","webpack://@flarum/markdown/external \"flarum.core.compat['components/TextEditor']\"","webpack://@flarum/markdown/external \"flarum.core.compat['Component']\"","webpack://@flarum/markdown/./node_modules/mdarea/mdarea.min.js","webpack://@flarum/markdown/external \"flarum.core.compat['helpers/icon']\"","webpack://@flarum/markdown/./src/forum/polyfills.js","webpack://@flarum/markdown/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flarum/markdown/./src/forum/components/MarkdownToolbar.js","webpack://@flarum/markdown/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@flarum/markdown/./src/forum/util/insertText.js","webpack://@flarum/markdown/./src/forum/util/styles.js","webpack://@flarum/markdown/./src/forum/util/apply.js","webpack://@flarum/markdown/./src/forum/components/MarkdownButton.js","webpack://@flarum/markdown/./src/forum/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","self","a","test","navigator","platform","f","_","g","y","b","v","K","e","this","_useTab","_useInline","_indent","_reOutdent","_reKey","_handleKey","setElement","RegExp","x","selectionStart","selectionEnd","arguments","length","window","InputEvent","dispatchEvent","constructor","getElement","_elem","removeEventListener","addEventListener","getValue","setValue","getIndent","setIndent","Array","join","replace","isTabUsed","useTab","ignoreTab","isInlineEnabled","enableInline","disableInline","destroy","defaultPrevented","target","substring","ctrlKey","altKey","metaKey","shiftKey","lastIndexOf","h","u","charAt","line","offset","prefix","exec","parseInt","preventDefault","String","startsWith","search","pos","endsWith","this_len","undefined","_inheritsLoose","subClass","superClass","__proto__","modifierKey","userAgent","match","MarkdownToolbar","config","isInitialized","document","getElementById","props","for","shortcut","view","id","data-for","style","display","children","event","button","element","querySelector","click","Component","_extends","assign","source","apply","canInsertText","isMultipleLines","string","trim","split","repeat","wordSelectionEnd","text","multiline","index","breakpoint","newlinesToSurroundSelectedText","textarea","newlinesToAppend","newlinesToPrepend","beforeSelection","slice","afterSelection","breaksBefore","breaksAfter","newlinesBeforeSelection","newlinesAfterSelection","blockStyle","arg","suffix","blockPrefix","blockSuffix","replaceNext","prefixSpace","scanFor","surroundWithNewlines","originalSelectionStart","originalSelectionEnd","selectedText","prefixToUse","suffixToUse","wordSelectionStart","expandedSelectionStart","expandedSelectionEnd","beginsWithPrefix","endsWithSuffix","expandSelectedText","hasReplaceNext","indexOf","ref","replacementText","position","Math","max","min","whitespaceEdges","trimFirst","leadingWhitespace","trailingWhitespace","styleSelectedText","styleArgs","result","orderedList","startOfLine","endOfLine","orderedListRegex","noInitialSelection","textToUnstyle","lines","linesBefore","linesToUnstyle","every","map","lengthDiff","len","results","push","multilineStyle","before","after","contentEditable","execCommand","error","createEvent","initEvent","setSelectionRange","insertText","MarkdownButton","$","tooltip","className","title","data-hotkey","hotkey","onclick","onkeydown","keydown","icon","stylesToApply","toolbar","parentElement","field","dataset","focus","app","initializers","add","extend","TextEditor","textareaId","vdom","attrs","context","editor","MarkdownArea","onunload","items","translator","trans"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['Component'];","!function(e,t){\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof module&&module.exports?module.exports=t():e.MarkdownArea=t()}(\"undefined\"!=typeof self?self:this,function(){var a=/mac|iphone|ipad|ipod/i.test(navigator.platform)?\"metaKey\":\"ctrlKey\",o=/^[\"'`*_[({<>})\\]]$/,f=/[*_]/,_=/^[ \\t]*(?:(?:[-+*]|\\d+\\.)[ \\t]+(?:\\[[ x]][ \\t]+)?|>[ \\t]*)*(?::[ \\t]*)?/,c=/(?:[-+*]|\\d+\\.)[ \\t]+(?:\\[[ x]][ \\t]+)?$/,g=/[-+*\\[\\]x\\d.]/g,y=/[^ \\t]/g,p=/(\\d+)\\.(?=[ \\t]+$)/,m=/(?:(?:^[ \\t]+)?(?:[-+*]|\\d+\\.|[>:])(?:[ \\t]+\\[[ x]])?[ \\t]*|^[ \\t]+)$/,d=/^(?!$)/gm,b={\"`\":/^``$/m,\"~\":/^~~$/m},v={\"[\":\"]\",\"(\":\")\",\"{\":\"}\",\"<\":\">\"},K={\"]\":\"[\",\")\":\"(\",\"}\":\"{\",\">\":\"<\"};function e(e){this._useTab=!0,this._useInline=!0,this._indent=\"    \",this._reOutdent=/^[ ]{4}/gm,this._reKey=t(!0,!0),this._handleKey=this._handleKey.bind(this),this.setElement(e)}function t(e,t){return new RegExp(\"^(?:Enter\"+(e?\"|Tab\":\"\")+\"|[io\"+(t?\"\\\"'`*_([{<>}\\\\])\":\"\")+\"])$\")}function x(e,t,n,i){if(e.value=t,e.selectionStart=n,e.selectionEnd=3<arguments.length?i:n,\"InputEvent\"in window)try{var s=new InputEvent(\"input\");e.dispatchEvent(s)}catch(i){}}return e.prototype={constructor:e,getElement:function(){return this._elem},setElement:function(e){this._elem&&this._elem.removeEventListener(\"keydown\",this._handleKey),(this._elem=e).addEventListener(\"keydown\",this._handleKey)},getValue:function(){return this._elem.value},setValue:function(e){this._elem.value=e},getIndent:function(){return this._indent},setIndent:function(e){this._indent=\"number\"==typeof e?new Array(e+1).join(\" \"):(e+\"\").replace(/[^ \\t]/g,\" \"),this._reOutdent=new RegExp(\"^\"+this._indent,\"mg\")},isTabUsed:function(){return this._useTab},useTab:function(){this._useTab=!0,this._reKey=t(!0,this._useInline)},ignoreTab:function(){this._useTab=!1,this._reKey=t(!1,this._useInline)},isInlineEnabled:function(){return this._useInline},enableInline:function(){this._useInline=!0,this._reKey=t(this._useTab,!0)},disableInline:function(){this._useInline=!1,this._reKey=t(this._useTab,!1)},destroy:function(){this._elem.removeEventListener(\"keydown\",this._handleKey),this._elem=this._reKey=this._handleKey=this._indent=this._reOutdent=null},_handleKey:function(e){if(!e.defaultPrevented&&this._reKey.test(e.key)){var t=e.target.value.substring(0,e.target.selectionStart),n=e.target.value.substring(e.target.selectionStart,e.target.selectionEnd),i=e.target.value.substring(e.target.selectionEnd);if(\"Enter\"!==e.key||e.ctrlKey||e.altKey||e.metaKey)if(\"Tab\"===e.key&&!e.shiftKey||\"i\"===e.key&&e[a])!function(e,t,n,i,s){var r=t.length,l=t.lastIndexOf(\"\\n\")+1;l<r&&(n=t.substring(l)+n,t=t.substring(0,l));(l<r||!n)&&(r+=s.length);n?n=n.replace(d,s):t+=s;x(e,t+n+i,r,n?l+n.length:r)}(this._elem,t,n,i,this._indent);else if(\"Tab\"===e.key&&e.shiftKey||\"o\"===e.key&&e[a])!function(e,t,n,i,s,r){var l=t.length,h=t.lastIndexOf(\"\\n\")+1;h<l&&(n=t.substring(h)+n,t=t.substring(0,h),n.substring(0,s.length)===s&&(l-=s.length));n=n.replace(r,\"\"),x(e,t+n+i,l,h+n.length)}(this._elem,t,n,i,this._indent,this._reOutdent);else{if(!o.test(e.key))return;s=this._elem,r=t,l=n,h=i,u=e.key,l||u in v||h.charAt(0)!==u?!l&&(\"'\"===u||u in K)?x(s,r+u+h,r.length+1):!l&&u in b&&b[u].test(r)?x(s,r+u+\"language\\n\"+u+u+u+(\"\\n\"!==h.charAt(0)?\"\\n\":\"\")+h,r.length+1,r.length+9):x(s,r+(K[u]||u)+l+(v[u]||u)+h,r.length+1,r.length+1+l.length):x(s,r+(f.test(u)?u+u:\"\")+h,r.length+1)}else!function(e,t,n,i,s){var r=n?null:(l=t,h=l.lastIndexOf(\"\\n\")+1,u=l.substring(h),a=_.exec(u),{line:u,offset:h,prefix:a&&a[0]});var l,h,u,a;!n&&r.prefix?s||r.prefix!==r.line?!s&&(d=r.prefix,c.test(d))?t+=\"\\n\"+r.prefix.replace(p,function(e,t){return parseInt(t)+1+\".\"}):t+=\"\\n\"+(o=r.prefix,f=s,o.replace(f?y:g,\" \")):t=t.substring(0,r.offset)+r.prefix.replace(m,\"\"):t+=\"\\n\";var o,f;var d;x(e,t+i,t.length)}(this._elem,t,n,i,e.shiftKey);e.preventDefault()}var s,r,l,h,u}},e});\n//# sourceMappingURL=mdarea.min.map\n","module.exports = flarum.core.compat['helpers/icon'];","/*! https://mths.be/startswith v0.2.0 by @mathias */\r\nif (!String.prototype.startsWith) {\r\n  Object.defineProperty(String.prototype, 'startsWith', {\r\n    value: function(search, pos) {\r\n      pos = !pos || pos < 0 ? 0 : +pos;\r\n      return this.substring(pos, pos + search.length) === search;\r\n    }\r\n  });\r\n}\r\n\r\nif (!String.prototype.endsWith) {\r\n  String.prototype.endsWith = function(search, this_len) {\r\n    if (this_len === undefined || this_len > this.length) {\r\n      this_len = this.length;\r\n    }\r\n    return this.substring(this_len - search.length, this_len) === search;\r\n  };\r\n}\r\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Component from 'flarum/Component';\r\n\r\nconst modifierKey = navigator.userAgent.match(/Macintosh/) ? 'Meta' : 'Control';\r\n\r\nexport default class MarkdownToolbar extends Component {\r\n  config(isInitialized) {\r\n    if (isInitialized) return;\r\n\r\n    const field = document.getElementById(this.props.for);\r\n\r\n    field.addEventListener('keydown', this.shortcut.bind(this));\r\n  }\r\n\r\n  view() {\r\n    return <div id=\"MarkdownToolbar\" data-for={this.props.for} style={{ display: 'inline-block' }}>\r\n      {this.props.children}\r\n    </div>;\r\n  }\r\n\r\n  shortcut(event) {\r\n    if ((event.metaKey && modifierKey === 'Meta') || (event.ctrlKey && modifierKey === 'Control')) {\r\n      const button = this.element.querySelector(`[data-hotkey=\"${event.key}\"]`);\r\n\r\n      if (button) {\r\n        button.click();\r\n        event.preventDefault()\r\n      }\r\n    }\r\n  }\r\n}\r\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","/*\r\n * Original Copyright GitHub, Inc. Licensed under the MIT License.\r\n * See license text at https://github.com/github/markdown-toolbar-element/blob/master/LICENSE.\r\n */\r\n\r\nexport let canInsertText = null;\r\n\r\nexport default (textarea, { text, selectionStart, selectionEnd }) => {\r\n  const originalSelectionStart = textarea.selectionStart;\r\n  const before = textarea.value.slice(0, originalSelectionStart);\r\n  const after = textarea.value.slice(textarea.selectionEnd);\r\n\r\n  if (canInsertText === null || canInsertText === true) {\r\n    textarea.contentEditable = 'true';\r\n    try {\r\n      canInsertText = document.execCommand('insertText', false, text);\r\n    }\r\n    catch (error) {\r\n      canInsertText = false;\r\n    }\r\n    textarea.contentEditable = 'false';\r\n  }\r\n  if (canInsertText && !textarea.value.slice(0, textarea.selectionStart).endsWith(text)) {\r\n    canInsertText = false;\r\n  }\r\n  if (!canInsertText) {\r\n    try {\r\n      document.execCommand('ms-beginUndoUnit');\r\n    }\r\n    catch (e) {\r\n      // Do nothing.\r\n    }\r\n    textarea.value = before + text + after;\r\n    try {\r\n      document.execCommand('ms-endUndoUnit');\r\n    }\r\n    catch (e) {\r\n      // Do nothing.\r\n    }\r\n\r\n    // fire custom event, works on IE\r\n    const event = document.createEvent('Event');\r\n\r\n    event.initEvent('input', true, true);\r\n\r\n    textarea.dispatchEvent(event);\r\n  }\r\n  if (selectionStart != null && selectionEnd != null) {\r\n    textarea.setSelectionRange(selectionStart, selectionEnd);\r\n  }\r\n  else {\r\n    textarea.setSelectionRange(originalSelectionStart, textarea.selectionEnd);\r\n  }\r\n};\r\n","/*\r\n * Original Copyright GitHub, Inc. Licensed under the MIT License.\r\n * See license text at https://github.com/github/markdown-toolbar-element/blob/master/LICENSE.\r\n */\r\n\r\nexport function isMultipleLines(string) {\r\n  return string.trim().split('\\n').length > 1;\r\n}\r\n\r\nexport function repeat(string, n) {\r\n  return Array(n + 1).join(string);\r\n}\r\n\r\nexport function wordSelectionStart(text, i) {\r\n  let index = i;\r\n\r\n  while (text[index] && text[index - 1] != null && !text[index - 1].match(/\\s/)) {\r\n    index--;\r\n  }\r\n\r\n  return index;\r\n}\r\n\r\nexport function wordSelectionEnd(text, i, multiline) {\r\n  let index = i;\r\n  const breakpoint = multiline ? /\\n/ : /\\s/;\r\n\r\n  while (text[index] && !text[index].match(breakpoint)) {\r\n    index++;\r\n  }\r\n\r\n  return index;\r\n}\r\n\r\nexport function expandSelectedText(textarea, prefixToUse, suffixToUse) {\r\n  let multiline = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\r\n\r\n  if (textarea.selectionStart === textarea.selectionEnd) {\r\n    textarea.selectionStart = wordSelectionStart(textarea.value, textarea.selectionStart);\r\n    textarea.selectionEnd = wordSelectionEnd(textarea.value, textarea.selectionEnd, multiline);\r\n  } else {\r\n    const expandedSelectionStart = textarea.selectionStart - prefixToUse.length;\r\n    const expandedSelectionEnd = textarea.selectionEnd + suffixToUse.length;\r\n    const beginsWithPrefix = textarea.value.slice(expandedSelectionStart, textarea.selectionStart) === prefixToUse;\r\n    const endsWithSuffix = textarea.value.slice(textarea.selectionEnd, expandedSelectionEnd) === suffixToUse;\r\n\r\n    if (beginsWithPrefix && endsWithSuffix) {\r\n      textarea.selectionStart = expandedSelectionStart;\r\n      textarea.selectionEnd = expandedSelectionEnd;\r\n    }\r\n  }\r\n\r\n  return textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\r\n}\r\n\r\nexport function newlinesToSurroundSelectedText(textarea) {\r\n  const beforeSelection = textarea.value.slice(0, textarea.selectionStart);\r\n  const afterSelection = textarea.value.slice(textarea.selectionEnd);\r\n  const breaksBefore = beforeSelection.match(/\\n*$/);\r\n  const breaksAfter = afterSelection.match(/^\\n*/);\r\n  const newlinesBeforeSelection = breaksBefore ? breaksBefore[0].length : 0;\r\n  const newlinesAfterSelection = breaksAfter ? breaksAfter[0].length : 0;\r\n  let newlinesToAppend;\r\n  let newlinesToPrepend;\r\n\r\n  if (beforeSelection.match(/\\S/) && newlinesBeforeSelection < 2) {\r\n    newlinesToAppend = repeat('\\n', 2 - newlinesBeforeSelection);\r\n  }\r\n\r\n  if (afterSelection.match(/\\S/) && newlinesAfterSelection < 2) {\r\n    newlinesToPrepend = repeat('\\n', 2 - newlinesAfterSelection);\r\n  }\r\n\r\n  if (newlinesToAppend == null) {\r\n    newlinesToAppend = '';\r\n  }\r\n\r\n  if (newlinesToPrepend == null) {\r\n    newlinesToPrepend = '';\r\n  }\r\n\r\n  return {\r\n    newlinesToAppend,\r\n    newlinesToPrepend\r\n  };\r\n}\r\n\r\nexport const blockStyle = (textarea, arg) => {\r\n  let newlinesToAppend;\r\n  let newlinesToPrepend;\r\n  const { prefix, suffix, blockPrefix, blockSuffix, replaceNext, prefixSpace, scanFor, surroundWithNewlines } = arg;\r\n  const originalSelectionStart = textarea.selectionStart;\r\n  const originalSelectionEnd = textarea.selectionEnd;\r\n  let selectedText = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\r\n  let prefixToUse = isMultipleLines(selectedText) && blockPrefix.length > 0 ? `${blockPrefix}\\n` : prefix;\r\n  let suffixToUse = isMultipleLines(selectedText) && blockSuffix.length > 0 ? `\\n${blockSuffix}` : suffix;\r\n\r\n  if (prefixSpace) {\r\n    const beforeSelection = textarea.value[textarea.selectionStart - 1];\r\n    if (textarea.selectionStart !== 0 && beforeSelection != null && !beforeSelection.match(/\\s/)) {\r\n      prefixToUse = ` ${prefixToUse}`;\r\n    }\r\n  }\r\n\r\n  selectedText = expandSelectedText(textarea, prefixToUse, suffixToUse, arg.multiline);\r\n  let selectionStart = textarea.selectionStart;\r\n  let selectionEnd = textarea.selectionEnd;\r\n  // const hasReplaceNext = replaceNext.length > 0 && suffixToUse.indexOf(replaceNext) > -1 && selectedText.length > 0;\r\n  const hasReplaceNext = replaceNext.length > 0 && prefixToUse.indexOf(replaceNext) > -1 && selectedText.length > 0;\r\n\r\n  if (surroundWithNewlines) {\r\n    const ref = newlinesToSurroundSelectedText(textarea);\r\n    newlinesToAppend = ref.newlinesToAppend;\r\n    newlinesToPrepend = ref.newlinesToPrepend;\r\n    prefixToUse = newlinesToAppend + prefix;\r\n    suffixToUse += newlinesToPrepend;\r\n  }\r\n\r\n  if (selectedText.startsWith(prefixToUse) && selectedText.endsWith(suffixToUse)) {\r\n    const replacementText = selectedText.slice(prefixToUse.length, selectedText.length - suffixToUse.length);\r\n    if (originalSelectionStart === originalSelectionEnd) {\r\n      let position = originalSelectionStart - prefixToUse.length;\r\n      position = Math.max(position, selectionStart);\r\n      position = Math.min(position, selectionStart + replacementText.length);\r\n      selectionStart = selectionEnd = position;\r\n    }\r\n    else {\r\n      selectionEnd = selectionStart + replacementText.length;\r\n    }\r\n    return { text: replacementText, selectionStart, selectionEnd };\r\n  }\r\n  else if (!hasReplaceNext) {\r\n    let replacementText = prefixToUse + selectedText + suffixToUse;\r\n    selectionStart = originalSelectionStart + prefixToUse.length;\r\n    selectionEnd = originalSelectionEnd + prefixToUse.length;\r\n    const whitespaceEdges = selectedText.match(/^\\s*|\\s*$/g);\r\n    if (arg.trimFirst && whitespaceEdges) {\r\n      const leadingWhitespace = whitespaceEdges[0] || '';\r\n      const trailingWhitespace = whitespaceEdges[1] || '';\r\n      replacementText = leadingWhitespace + prefixToUse + selectedText.trim() + suffixToUse + trailingWhitespace;\r\n      selectionStart += leadingWhitespace.length;\r\n      selectionEnd -= trailingWhitespace.length;\r\n    }\r\n    return { text: replacementText, selectionStart, selectionEnd };\r\n  }\r\n  else if (scanFor.length > 0 && selectedText.match(scanFor)) {\r\n    // suffixToUse = suffixToUse.replace(replaceNext, selectedText);\r\n    prefixToUse = prefixToUse.replace(replaceNext, selectedText);\r\n    const replacementText = prefixToUse + suffixToUse;\r\n    selectionStart = selectionEnd = selectionStart + prefixToUse.length;\r\n    return { text: replacementText, selectionStart, selectionEnd };\r\n  }\r\n  else {\r\n    const replacementText = prefixToUse + selectedText + suffixToUse;\r\n    // selectionStart = selectionStart + prefixToUse.length + selectedText.length + suffixToUse.indexOf(replaceNext);\r\n    selectionStart = selectionStart + prefixToUse.length;\r\n    // selectionEnd = selectionStart + replaceNext.length;\r\n    selectionEnd = selectionStart + selectedText.length;\r\n    return { text: replacementText, selectionStart, selectionEnd };\r\n  }\r\n}\r\n\r\nexport const multilineStyle = (textarea, arg) => {\r\n  const { prefix, suffix, surroundWithNewlines } = arg;\r\n  let text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\r\n  let selectionStart = textarea.selectionStart;\r\n  let selectionEnd = textarea.selectionEnd;\r\n  const lines = text.split('\\n');\r\n  const undoStyle = lines.every(line => line.startsWith(prefix) && line.endsWith(suffix));\r\n  if (undoStyle) {\r\n    text = lines.map(line => line.slice(prefix.length, line.length - suffix.length)).join('\\n');\r\n    selectionEnd = selectionStart + text.length;\r\n  }\r\n  else {\r\n    text = lines.map(line => prefix + line + suffix).join('\\n');\r\n    if (surroundWithNewlines) {\r\n      const { newlinesToAppend, newlinesToPrepend } = newlinesToSurroundSelectedText(textarea);\r\n      selectionStart += newlinesToAppend.length;\r\n      selectionEnd = selectionStart + text.length;\r\n      text = newlinesToAppend + text + newlinesToPrepend;\r\n    }\r\n  }\r\n  return { text, selectionStart, selectionEnd };\r\n}\r\n\r\nexport const orderedList = (textarea) => {\r\n  const orderedListRegex = /^\\d+\\.\\s+/;\r\n  const noInitialSelection = textarea.selectionStart === textarea.selectionEnd;\r\n  let selectionEnd;\r\n  let selectionStart;\r\n  let text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\r\n  let textToUnstyle = text;\r\n  let lines = text.split('\\n');\r\n  let startOfLine, endOfLine;\r\n  if (noInitialSelection) {\r\n    const linesBefore = textarea.value.slice(0, textarea.selectionStart).split(/\\n/);\r\n    startOfLine = textarea.selectionStart - linesBefore[linesBefore.length - 1].length;\r\n    endOfLine = wordSelectionEnd(textarea.value, textarea.selectionStart, true);\r\n    textToUnstyle = textarea.value.slice(startOfLine, endOfLine);\r\n  }\r\n  const linesToUnstyle = textToUnstyle.split('\\n');\r\n  const undoStyling = linesToUnstyle.every(line => orderedListRegex.test(line));\r\n  if (undoStyling) {\r\n    lines = linesToUnstyle.map(line => line.replace(orderedListRegex, ''));\r\n    text = lines.join('\\n');\r\n    if (noInitialSelection && startOfLine && endOfLine) {\r\n      const lengthDiff = linesToUnstyle[0].length - lines[0].length;\r\n      selectionStart = selectionEnd = textarea.selectionStart - lengthDiff;\r\n      textarea.selectionStart = startOfLine;\r\n      textarea.selectionEnd = endOfLine;\r\n    }\r\n  }\r\n  else {\r\n    lines = (function () {\r\n      let i;\r\n      let len;\r\n      let index;\r\n      const results = [];\r\n      for (index = i = 0, len = lines.length; i < len; index = ++i) {\r\n        const line = lines[index];\r\n        results.push(`${index + 1}. ${line}`);\r\n      }\r\n      return results;\r\n    })();\r\n    text = lines.join('\\n');\r\n    const { newlinesToAppend, newlinesToPrepend } = newlinesToSurroundSelectedText(textarea);\r\n    selectionStart = textarea.selectionStart + newlinesToAppend.length;\r\n    selectionEnd = selectionStart + text.length;\r\n    if (noInitialSelection)\r\n      selectionStart = selectionEnd;\r\n    text = newlinesToAppend + text + newlinesToPrepend;\r\n  }\r\n  return { text, selectionStart, selectionEnd };\r\n}\r\n","/*\r\n * Original Copyright GitHub, Inc. Licensed under the MIT License.\r\n * See license text at https://github.com/github/markdown-toolbar-element/blob/master/LICENSE.\r\n */\r\n\r\nimport insertText from './insertText';\r\nimport { blockStyle, isMultipleLines, multilineStyle, orderedList } from './styles';\r\n\r\nexport const styleSelectedText = (textarea, styleArgs) => {\r\n  const text = textarea.value.slice(textarea.selectionStart, textarea.selectionEnd);\r\n  let result;\r\n  if (styleArgs.orderedList) {\r\n    result = orderedList(textarea);\r\n  }\r\n  else if (styleArgs.multiline && isMultipleLines(text)) {\r\n    result = multilineStyle(textarea, styleArgs);\r\n  }\r\n  else {\r\n    result = blockStyle(textarea, styleArgs);\r\n  }\r\n\r\n  insertText(textarea, result);\r\n};\r\n\r\nexport default (button, stylesToApply) => {\r\n  const toolbar = button.parentElement;\r\n\r\n  const defaults = {\r\n    prefix: '',\r\n    suffix: '',\r\n    blockPrefix: '',\r\n    blockSuffix: '',\r\n    multiline: false,\r\n    replaceNext: '',\r\n    prefixSpace: false,\r\n    scanFor: '',\r\n    surroundWithNewlines: false,\r\n    orderedList: false,\r\n    trimFirst: false\r\n  };\r\n\r\n  const style = Object.assign({}, defaults, stylesToApply);\r\n\r\n  const field = document.getElementById(toolbar.dataset.for);\r\n\r\n  if (field) {\r\n    field.focus();\r\n    styleSelectedText(field, style);\r\n  }\r\n}\r\n","import Component from 'flarum/Component';\r\nimport icon from 'flarum/helpers/icon';\r\nimport apply from '../util/apply';\r\n\r\nconst modifierKey = navigator.userAgent.match(/Macintosh/) ? '⌘' : 'ctrl';\r\n\r\nexport default class MarkdownButton extends Component {\r\n  config(isInitialized) {\r\n    if (isInitialized) return;\r\n\r\n    this.$().tooltip();\r\n  }\r\n\r\n  view() {\r\n    return <button className=\"Button Button--icon Button--link\" title={this.title()} data-hotkey={this.props.hotkey}\r\n                   onclick={this.click.bind(this)} onkeydown={this.keydown.bind(this)}>\r\n      {icon(this.props.icon)}\r\n    </button>;\r\n  }\r\n\r\n  keydown(event) {\r\n    if (event.key === ' ' || event.key === 'Enter') {\r\n      event.preventDefault();\r\n      this.click();\r\n    }\r\n  }\r\n\r\n  click() {\r\n    return apply(this.element, this.props.style);\r\n  }\r\n\r\n  title() {\r\n    let tooltip = this.props.title;\r\n\r\n    if (this.props.hotkey) tooltip += ` <${modifierKey}-${this.props.hotkey}>`;\r\n\r\n    return tooltip;\r\n  }\r\n}\r\n","/*!\n * Includes modified code from GitHub Markdown Toolbar Element\n * https://github.com/github/markdown-toolbar-element/\n *\n * Original Copyright GitHub, Inc.\n * Released under the MIT license\n * https://github.com/github/markdown-toolbar-element/blob/master/LICENSE\n */\n\nimport { extend } from 'flarum/extend';\nimport TextEditor from 'flarum/components/TextEditor';\nimport MarkdownArea from 'mdarea';\n\nimport './polyfills';\nimport MarkdownToolbar from './components/MarkdownToolbar';\nimport MarkdownButton from './components/MarkdownButton';\n\napp.initializers.add('flarum-markdown', function(app) {\n\n  let index = 1;\n\n  extend(TextEditor.prototype, 'init', function() {\n    this.textareaId = 'textarea'+(index++);\n  });\n\n  extend(TextEditor.prototype, 'view', function(vdom) {\n    vdom.children[0].attrs.id = this.textareaId;\n  });\n\n  extend(TextEditor.prototype, 'configTextarea', function(value, element, isInitialized, context) {\n    if (isInitialized) return;\n\n    const editor = new MarkdownArea(element);\n    editor.disableInline();\n    editor.ignoreTab();\n\n    context.onunload = function() {\n      editor.destroy();\n    };\n  });\n\n  extend(TextEditor.prototype, 'toolbarItems', function(items) {\n    const tooltip = name => app.translator.trans(`flarum-markdown.forum.composer.${name}_tooltip`);\n\n    items.add('markdown', (\n      <MarkdownToolbar for={this.textareaId}>\n        <MarkdownButton title={tooltip('header')} icon=\"fas fa-heading\" style={{ prefix: '[h3]', suffix: '[/h3]' }} />\n        <MarkdownButton title={tooltip('bold')} icon=\"fas fa-bold\" style={{ prefix: '[b]', suffix: '[/b]', trimFirst: true }} hotkey=\"b\" />\n        <MarkdownButton title={tooltip('italic')} icon=\"fas fa-italic\" style={{ prefix: '[i]', suffix: '[/i]', trimFirst: true }} hotkey=\"i\" />\n        <MarkdownButton title=\"居中\" icon=\"fas fa-align-center\" style={{ prefix: '[center]', suffix: '[/center]', trimFirst: true }} />\n        <MarkdownButton title={tooltip('quote')} icon=\"fas fa-quote-left\" style={{ prefix: '[quote]', suffix: '[/quote]', multiline: true, surroundWithNewlines: true }} />\n        <MarkdownButton title={tooltip('link')} icon=\"fas fa-link\" style={{ prefix: '[url=链接网址]', suffix: '[/url]', replaceNext: '链接网址', scanFor: 'https?://' }} />\n        <MarkdownButton title=\"影像阅片\" icon=\"fas fa-laptop-medical\" style={{ prefix: '[pacs=阅片地址]', suffix: '[/pacs]', replaceNext: '阅片地址', scanFor: 'https?://viewer.weiyun.rimag.com.cn/' }} />\n      </MarkdownToolbar>\n    ), 100);\n  });\n});\n"],"sourceRoot":""}